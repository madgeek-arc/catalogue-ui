<ng-content select=".form-top-section"></ng-content>

<div *ngIf="downloadPDF" class="uk-flex uk-flex-right">
  <button class="uk-button uk-button-secondary" (click)="generatePDF()"
          data-uk-tooltip="title:Unsaved changes will not be displayed to pdf; pos: bottom">Download as pdf
  </button>
</div>

<!--Chapter Selection-->
<div *ngIf="model && ready" [ngClass]="{'uk-hidden': (model.sections.length === 1 || !model.sections[0].subSections)}">
  <ul class="chapter-tabs uk-tab" data-uk-tab="connect: #top-navigation-tabs; animation: uk-animation-fade">
    <li class="" *ngFor="let section of model.sections">
      <a *ngIf="(!section.subType || section.subType===subType)" (click)="showUnsavedChangesPrompt(section)">
        <span>{{section.name}}</span>
        <span *ngIf="chapterChangeMap.get(section.id)" class="material-icons uk-margin-small-left">circle</span>
        <span *ngIf="commentsPerSection.get(section.id)" class="uk-flex uk-flex-middle">
          {{ commentsPerSection.get(section.id) }}
          <span class="material-symbols-outlined" style="font-size: 18px">chat</span>
        </span>
      </a>
    </li>
  </ul>
</div>

<ng-content select=".form-action-bar"></ng-content>

<pre *ngIf="errorMessage" id="errorAlert" class="uk-alert uk-alert-danger" data-uk-alert="duration: 500" style="border-width: 0">
  <a (click)="closeError()" class="uk-alert-close" data-uk-close></a>
  {{ errorMessage }}
</pre>

<div *ngIf="successMessage" id="successAlert" class="uk-alert uk-alert-success" data-uk-alert="duration: 500">
  <p>{{ successMessage }}</p>
</div>

<div *ngIf="ready; else showLoader">
  <ul id="top-navigation-tabs" class="uk-switcher">
    <li *ngFor="let section of model.sections let i = index">
      <app-chapter [form]="getFormGroup(i)" [readonly]="readonly" [validate]="validate"
                   [chapter]="model.sections[i]" [vocabularies]="vocabulariesMap" [tabsHeader]="tabsHeader"
                   [fields]="model.sections[i].subSections ?? model.sections"
                   [subVocabularies]="subVocabularies" [mandatoryFieldsText]="mandatoryFieldsText"
                   [editMode]=editMode [enableCommenting]="enableCommenting"
                   (totalComments)="setCommentCount($event.sectionId, $event.comments)"
                   (chapterHasChanges)="setChapterChangesMap($event)">
      </app-chapter>
    </li>
  </ul>
</div>

<ng-template #showLoader class="whiteFilm">
  <i class="loader-big" aria-hidden="true"></i>
</ng-template>

<div class="uk-position-fixed" style="z-index: 100; top: 90vh; right: 0.4vw">
  <a data-uk-totop style="padding: 18px;" (click)="toTop()"></a>
</div>

<!--<pre *ngIf="form">{{form.value | json}}</pre>-->

<!-- Validation modal -->
<div id="validation-modal" data-uk-modal="esc-close: false; bg-close: false">
  <div class="uk-modal-dialog uk-modal-body">
    <h2 class="uk-modal-title">Survey validation</h2>
    <p>The survey fields will be validated and if all required fields are present it will be locked and it will not be
    editable until unlocked.</p>
    <p class="uk-text-right">
      <button class="uk-button uk-button-secondary uk-modal-close" type="button">Close</button>
      <button class="uk-button uk-button-primary" type="button" (click)="validateForm()">I agree</button>
    </p>
  </div>
</div>

<!-- Unsaved changes modal -->
<div id="unsaved-changes-modal" data-uk-modal="esc-close: false; bg-close: false">
  <div class="uk-modal-dialog uk-modal-body">
<!--    <h2 class="uk-modal-title"></h2>-->
    <p>There are unsaved changes, do you want to submit them before moving on?</p>
    <p class="uk-text-right">
      <button class="uk-button uk-button-secondary uk-modal-close" type="button">I will do it later</button>
      <button class="uk-button uk-button-primary" type="button" (click)="parentSubmit()">Submit now</button>
    </p>
  </div>
</div>
